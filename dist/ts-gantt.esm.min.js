class t{}t.CSS_VAR_SEPARATOR_WIDTH="--tsg-separator-width",t.CSS_VAR_HEADER_HEIGHT="--tsg-header-height",t.CSS_VAR_ROW_HEIGHT="--tsg-row-height",t.CSS_VAR_GRIDLINES_WIDTH="--tsg-gridlines-width",t.CSS_VAR_BAR_STROKE_WIDTH="--tsg-bar-stroke-width",t.WRAPPER_CLASS="tsg-wrapper",t.FOOTER_CLASS="tsg-footer",t.TABLE_WRAPPER_CLASS="tsg-table-wrapper",t.CHART_WRAPPER_CLASS="tsg-chart-wrapper",t.TABLE_CLASS="tsg-table",t.CHART_CLASS="tsg-chart",t.SEPARATOR_CLASS="tsg-separator",t.ROW_UUID_ATTRIBUTE="data-tsg-row-uuid",t.ROW_UUID_DATASET_KEY="tsgRowUuid",t.ROW_SELECTED_CLASS="selected",t.ROW_CLICK="tsgrowclick",t.TABLE_CELL_TEXT_WRAPPER_CLASS="tsg-cell-text-wrapper",t.TABLE_CELL_TEXT_CLASS="tsg-cell-text",t.TABLE_CELL_INDENT_CLASS="tsg-cell-text-indent",t.TABLE_CELL_EXPANDER_CLASS="tsg-cell-text-expander",t.CELL_EXPANDER_CLICK="tsgexpanderclick",t.CHART_HEADER_CLASS="tsg-chart-header",t.CHART_HEADER_BACKGROUND_CLASS="tsg-chart-header-bg",t.CHART_HEADER_GRIDLINES_CLASS="tsg-chart-header-gl",t.CHART_HEADER_TEXT_CLASS="tsg-chart-header-text",t.CHART_BODY_CLASS="tsg-chart-body",t.CHART_BODY_BACKGROUND_CLASS="tsg-chart-body-bg",t.CHART_BODY_GRIDLINES_CLASS="tsg-chart-body-gl",t.CHART_BODY_TODAY_LINE_CLASS="today",t.CHART_ROW_WRAPPER_CLASS="tsg-chart-row-wrapper",t.CHART_ROW_CLASS="tsg-chart-row",t.CHART_ROW_BACKGROUND_CLASS="tsg-chart-row-bg",t.CHART_BAR_GROUP_CLASS="tsg-chart-bar-group",t.CHART_BAR_WRAPPER_CLASS="tsg-chart-bar-wrapper",t.CHART_BAR_PLANNED_CLASS="tsg-chart-bar-planned",t.CHART_BAR_PLANNED_PROGRESS_CLASS="tsg-chart-bar-planned-progress",t.CHART_BAR_ACTUAL_CLASS="tsg-chart-bar-actual",t.CHART_BAR_ACTUAL_PROGRESS_CLASS="tsg-chart-bar-actual-progress";"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var e=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t,e){t.exports=function(){var t="millisecond",e="second",s="minute",a="hour",i="day",n="week",r="month",o="quarter",d="year",h=/^(\d{4})-?(\d{1,2})-?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?.?(\d{1,3})?$/,l=/\[([^\]]+)]|Y{2,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,c=function(t,e,s){var a=String(t);return!a||a.length>=e?t:""+Array(e+1-a.length).join(s)+t},u={s:c,z:function(t){var e=-t.utcOffset(),s=Math.abs(e),a=Math.floor(s/60),i=s%60;return(e<=0?"+":"-")+c(a,2,"0")+":"+c(i,2,"0")},m:function(t,e){var s=12*(e.year()-t.year())+(e.month()-t.month()),a=t.clone().add(s,r),i=e-a<0,n=t.clone().add(s+(i?-1:1),r);return Number(-(s+(e-a)/(i?a-n:n-a))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(h){return{M:r,y:d,w:n,d:i,D:"date",h:a,m:s,s:e,ms:t,Q:o}[h]||String(h||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},_={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},p="en",S={};S[p]=_;var f=function(t){return t instanceof C},A=function(t,e,s){var a;if(!t)return p;if("string"==typeof t)S[t]&&(a=t),e&&(S[t]=e,a=t);else{var i=t.name;S[i]=t,a=i}return!s&&a&&(p=a),a||!s&&p},m=function(t,e){if(f(t))return t.clone();var s="object"==typeof e?e:{};return s.date=t,s.args=arguments,new C(s)},E=u;E.l=A,E.i=f,E.w=function(t,e){return m(t,{locale:e.$L,utc:e.$u,$offset:e.$offset})};var C=function(){function c(t){this.$L=this.$L||A(t.locale,null,!0),this.parse(t)}var u=c.prototype;return u.parse=function(t){this.$d=function(t){var e=t.date,s=t.utc;if(null===e)return new Date(NaN);if(E.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var a=e.match(h);if(a)return s?new Date(Date.UTC(a[1],a[2]-1,a[3]||1,a[4]||0,a[5]||0,a[6]||0,a[7]||0)):new Date(a[1],a[2]-1,a[3]||1,a[4]||0,a[5]||0,a[6]||0,a[7]||0)}return new Date(e)}(t),this.init()},u.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},u.$utils=function(){return E},u.isValid=function(){return!("Invalid Date"===this.$d.toString())},u.isSame=function(t,e){var s=m(t);return this.startOf(e)<=s&&s<=this.endOf(e)},u.isAfter=function(t,e){return m(t)<this.startOf(e)},u.isBefore=function(t,e){return this.endOf(e)<m(t)},u.$g=function(t,e,s){return E.u(t)?this[e]:this.set(s,t)},u.year=function(t){return this.$g(t,"$y",d)},u.month=function(t){return this.$g(t,"$M",r)},u.day=function(t){return this.$g(t,"$W",i)},u.date=function(t){return this.$g(t,"$D","date")},u.hour=function(t){return this.$g(t,"$H",a)},u.minute=function(t){return this.$g(t,"$m",s)},u.second=function(t){return this.$g(t,"$s",e)},u.millisecond=function(e){return this.$g(e,"$ms",t)},u.unix=function(){return Math.floor(this.valueOf()/1e3)},u.valueOf=function(){return this.$d.getTime()},u.startOf=function(t,o){var h=this,l=!!E.u(o)||o,c=E.p(t),u=function(t,e){var s=E.w(h.$u?Date.UTC(h.$y,e,t):new Date(h.$y,e,t),h);return l?s:s.endOf(i)},_=function(t,e){return E.w(h.toDate()[t].apply(h.toDate("s"),(l?[0,0,0,0]:[23,59,59,999]).slice(e)),h)},p=this.$W,S=this.$M,f=this.$D,A="set"+(this.$u?"UTC":"");switch(c){case d:return l?u(1,0):u(31,11);case r:return l?u(1,S):u(0,S+1);case n:var m=this.$locale().weekStart||0,C=(p<m?p+7:p)-m;return u(l?f-C:f+(6-C),S);case i:case"date":return _(A+"Hours",0);case a:return _(A+"Minutes",1);case s:return _(A+"Seconds",2);case e:return _(A+"Milliseconds",3);default:return this.clone()}},u.endOf=function(t){return this.startOf(t,!1)},u.$set=function(n,o){var h,l=E.p(n),c="set"+(this.$u?"UTC":""),u=(h={},h.day=c+"Date",h.date=c+"Date",h[r]=c+"Month",h[d]=c+"FullYear",h[a]=c+"Hours",h[s]=c+"Minutes",h[e]=c+"Seconds",h[t]=c+"Milliseconds",h)[l],_=l===i?this.$D+(o-this.$W):o;if(l===r||l===d){var p=this.clone().set("date",1);p.$d[u](_),p.init(),this.$d=p.set("date",Math.min(this.$D,p.daysInMonth())).toDate()}else u&&this.$d[u](_);return this.init(),this},u.set=function(t,e){return this.clone().$set(t,e)},u.get=function(t){return this[E.p(t)]()},u.add=function(t,o){var h,l=this;t=Number(t);var c=E.p(o),u=function(e){var s=m(l);return E.w(s.date(s.date()+Math.round(e*t)),l)};if(c===r)return this.set(r,this.$M+t);if(c===d)return this.set(d,this.$y+t);if(c===i)return u(1);if(c===n)return u(7);var _=(h={},h[s]=6e4,h[a]=36e5,h[e]=1e3,h)[c]||1,p=this.$d.getTime()+t*_;return E.w(p,this)},u.subtract=function(t,e){return this.add(-1*t,e)},u.format=function(t){var e=this;if(!this.isValid())return"Invalid Date";var s=t||"YYYY-MM-DDTHH:mm:ssZ",a=E.z(this),i=this.$locale(),n=this.$H,r=this.$m,o=this.$M,d=i.weekdays,h=i.months,c=function(t,a,i,n){return t&&(t[a]||t(e,s))||i[a].substr(0,n)},u=function(t){return E.s(n%12||12,t,"0")},_=i.meridiem||function(t,e,s){var a=t<12?"AM":"PM";return s?a.toLowerCase():a},p={YY:String(this.$y).slice(-2),YYYY:this.$y,M:o+1,MM:E.s(o+1,2,"0"),MMM:c(i.monthsShort,o,h,3),MMMM:h[o]||h(this,s),D:this.$D,DD:E.s(this.$D,2,"0"),d:String(this.$W),dd:c(i.weekdaysMin,this.$W,d,2),ddd:c(i.weekdaysShort,this.$W,d,3),dddd:d[this.$W],H:String(n),HH:E.s(n,2,"0"),h:u(1),hh:u(2),a:_(n,r,!0),A:_(n,r,!1),m:String(r),mm:E.s(r,2,"0"),s:String(this.$s),ss:E.s(this.$s,2,"0"),SSS:E.s(this.$ms,3,"0"),Z:a};return s.replace(l,(function(t,e){return e||p[t]||a.replace(":","")}))},u.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},u.diff=function(t,i,h){var l,c=E.p(i),u=m(t),_=6e4*(u.utcOffset()-this.utcOffset()),p=this-u,S=E.m(this,u);return S=(l={},l[d]=S/12,l[r]=S,l[o]=S/3,l[n]=(p-_)/6048e5,l.day=(p-_)/864e5,l[a]=p/36e5,l[s]=p/6e4,l[e]=p/1e3,l)[c]||p,h?S:E.a(S)},u.daysInMonth=function(){return this.endOf(r).$D},u.$locale=function(){return S[this.$L]},u.locale=function(t,e){if(!t)return this.$L;var s=this.clone(),a=A(t,e,!0);return a&&(s.$L=a),s},u.clone=function(){return E.w(this.$d,this)},u.toDate=function(){return new Date(this.valueOf())},u.toJSON=function(){return this.isValid()?this.toISOString():null},u.toISOString=function(){return this.$d.toISOString()},u.toString=function(){return this.$d.toUTCString()},c}();return m.prototype=C.prototype,m.extend=function(t,e){return t(e,C,m),m},m.locale=A,m.isDayjs=f,m.unix=function(t){return m(1e3*t)},m.en=S[p],m.Ls=S,m}()}));function s(t,e=[],s=[],a=null,i=null){const n=document.createElementNS("http://www.w3.org/2000/svg",t);for(const t of s)n.setAttribute(t[0],t[1]);return 0!==e.length&&n.classList.add(...e),i&&(n.innerHTML=i),a&&a.append(n),n}class a{constructor(t,s,a,i,n,r=null,o=null,d=null,h=null,l=0,c=!1,u=null,_=null){this._progress=0,this.externalId=t,this.parentExternalId=s,this.name=a,this.localizedNames=i,this.progress=n,this.datePlannedStart=r?e(r):null,this.datePlannedEnd=o?e(o):null,this.dateActualStart=d?e(d):null,this.dateActualEnd=h?e(h):null,this.nestingLvl=l,this.hasChildren=c,this.parentUuid=u,this.uuid=_||crypto.getRandomValues(new Uint32Array(4)).join("-"),this.shown=!u,this.expanded=!1}set progress(t){this._progress=t<0?0:t>100?100:t}get progress(){return this._progress}static convertModelsToTasks(t,e=new Map){const s=t.slice(),i=new Set(s.map(t=>t.parentId)),n=[];let r=[];for(let t=s.length-1;t>=0;t--){const o=s[t];if(!o.parentId){const d=new a(o.id,o.parentId,o.name,o.localizedNames,o.progress,o.datePlannedStart,o.datePlannedEnd,o.dateActualStart,o.dateActualEnd,0,i.has(o.id),null,e.get(o.id));n.push(d),r.push(d),s.splice(t,1)}}let o=1;for(;0!==r.length;){const t=[];r.filter(t=>t.hasChildren).forEach(r=>{for(let d=s.length-1;d>=0;d--){const h=s[d];if(h.parentId===r.externalId){const l=new a(h.id,h.parentId,h.name,h.localizedNames,h.progress,h.datePlannedStart,h.datePlannedEnd,h.dateActualStart,h.dateActualEnd,o,i.has(h.id),r.uuid,e.get(h.id));n.push(l),t.push(l),s.splice(d,1)}}}),r=t,o++}return n}static convertTasksToModels(t){return t.map(t=>{var e,s,a,i;return{id:t.externalId,parentId:t.parentExternalId,name:t.name,progress:t.progress,datePlannedStart:(null===(e=t.datePlannedStart)||void 0===e?void 0:e.toDate())||null,datePlannedEnd:(null===(s=t.datePlannedEnd)||void 0===s?void 0:s.toDate())||null,dateActualStart:(null===(a=t.dateActualStart)||void 0===a?void 0:a.toDate())||null,dateActualEnd:(null===(i=t.dateActualEnd)||void 0===i?void 0:i.toDate())||null,localizedNames:t.localizedNames}})}static detectTaskChanges(t){const{oldTasks:e,newTasks:s}=t,a=e.map(t=>t.uuid),i=s.map(t=>t.uuid),n=e.filter(t=>!i.includes(t.uuid)),r=[],o=[];for(const t of s){if(!a.includes(t.uuid)){r.push(t);continue}const s=e.find(e=>e.uuid===t.uuid);t.equals(s)||o.push(t)}return{deleted:n,added:r,changed:o,all:s}}static getTasksIdsMap(t){const e=new Map;for(const s of t)e.has(s.externalId)||e.set(s.externalId,s.uuid);return e}static checkPaternity(t,e,s){var a;let i=s.parentUuid;for(;i;){if(i===e.uuid)return!0;i=null===(a=t.find(t=>t.uuid===i))||void 0===a?void 0:a.parentUuid}return!1}static sortTasksRecursively(t,e){const s=t.filter(t=>t.parentUuid===e).sort((t,e)=>t.compareTo(e)),a=[];for(const e of s)a.push(e),a.push(...this.sortTasksRecursively(t,e.uuid));return a}equals(t){var e,s,a,i,n,r,o,d;return this.externalId===t.externalId&&this.parentExternalId===t.parentExternalId&&this.nestingLvl===t.nestingLvl&&this.hasChildren===t.hasChildren&&this.name===t.name&&this.progress===t.progress&&(null===(e=this.datePlannedStart)||void 0===e?void 0:e.unix())===(null===(s=t.datePlannedStart)||void 0===s?void 0:s.unix())&&(null===(a=this.datePlannedEnd)||void 0===a?void 0:a.unix())===(null===(i=t.datePlannedEnd)||void 0===i?void 0:i.unix())&&(null===(n=this.dateActualStart)||void 0===n?void 0:n.unix())===(null===(r=t.dateActualStart)||void 0===r?void 0:r.unix())&&(null===(o=this.dateActualEnd)||void 0===o?void 0:o.unix())===(null===(d=t.dateActualEnd)||void 0===d?void 0:d.unix())}compareTo(t){var e,s,a,i,n,r,o,d,h,l,c,u,_,p,S,f;return this.nestingLvl>t.nestingLvl?1:this.nestingLvl<t.nestingLvl?-1:(null===(e=this.datePlannedStart)||void 0===e?void 0:e.unix())>(null===(s=t.datePlannedStart)||void 0===s?void 0:s.unix())?1:(null===(a=this.datePlannedStart)||void 0===a?void 0:a.unix())<(null===(i=t.datePlannedStart)||void 0===i?void 0:i.unix())?-1:(null===(n=this.datePlannedEnd)||void 0===n?void 0:n.unix())>(null===(r=t.datePlannedEnd)||void 0===r?void 0:r.unix())?1:(null===(o=this.datePlannedEnd)||void 0===o?void 0:o.unix())<(null===(d=t.datePlannedEnd)||void 0===d?void 0:d.unix())?-1:(null===(h=this.dateActualStart)||void 0===h?void 0:h.unix())>(null===(l=t.dateActualStart)||void 0===l?void 0:l.unix())?1:(null===(c=this.dateActualStart)||void 0===c?void 0:c.unix())<(null===(u=t.dateActualStart)||void 0===u?void 0:u.unix())?-1:(null===(_=this.dateActualEnd)||void 0===_?void 0:_.unix())>(null===(p=t.dateActualEnd)||void 0===p?void 0:p.unix())?1:(null===(S=this.dateActualEnd)||void 0===S?void 0:S.unix())<(null===(f=t.dateActualEnd)||void 0===f?void 0:f.unix())?-1:this.name.localeCompare(t.name)}}class i{constructor(t=null){this.enableChartEdit=!1,this.enablePlannedDatesEdit=!0,this.enableActualDatesEdit=!0,this.bindParentDatesToChild=!0,this.enableProgressEdit=!0,this.drawTodayLine=!0,this.columnsMinWidthPx=[200,100,100,100,100,100,100,100],this.columnsContentAlign=["start","end","center","center","center","center","center","center"],this.separatorWidthPx=5,this.headerHeightPx=90,this.rowHeightPx=40,this.borderWidthPx=1,this.barStrokeWidthPx=2,this.barMarginPx=2,this.barCornerRadiusPx=6,this.rowSymbols={childless:"•",collapsed:"▾",expanded:"▴"},this.chartShowProgress=!0,this.chartDisplayMode="both",this.chartScale="month",this.chartDateOffsetDays={day:14,week:60,month:240,year:730},this.chartDateOffsetDaysMin={day:7,week:30,month:120,year:365},this.chartDayWidthPx={day:60,week:20,month:3,year:1},this.locale="en",this.localeDecimalSeparator={en:".",uk:",",ru:","},this.localeDateFormat={en:"MM/DD/YYYY",uk:"DD.MM.YYYY",ru:"DD.MM.YYYY"},this.localeFirstWeekDay={en:0,uk:1,ru:1},this.localeDateMonths={en:["January","February","March","April","May","June","July","August","September","October","November","December"],uk:["Січень","Лютий","Березень","Квітень","Травень","Червень","Липень","Серпень","Вересень","Жовтень","Листопад","Грудень"],ru:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"]},this.localeDateDays={en:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],uk:["Неділя","Понеділок","Вівторок","Середа","Четвер","П'ятниця","Субота"],ru:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"]},this.localeDateDaysShort={en:["Su","Mo","Tu","We","Th","Fr","Sa"],uk:["Нд","Пн","Вт","Ср","Чт","Пт","Сб"],ru:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"]},this.localeDateScale={en:["Weeks","Months","Years"],uk:["Тижні","Місяці","Роки"],ru:["Недели","Месяцы","Годы"]},this.localeFooters={en:["Total tasks","Completed"],uk:["Всього задач","Завершено"],ru:["Всего задач","Завершено"]},this.localeHeaders={en:["Name","Progress","Start date planned","End date planned","Start date actual","End date actual","Duration planned","Duration actual"],uk:["Ім'я","Прогрес","Дата початку планована","Дата завершення планована","Дата початку фактична","Дата завершення фактична","Тривалість планована","Тривалість фактична"],ru:["Имя","Прогресс","Дата начала планируемая","Дата окончания планируемая","Дата начала фактическая","Дата окончания фактическая","Длительность планируемая","Длительность фактическая"]},this.localeDurationFormatters={en:t=>1===t?"1 day":t+" days",uk:t=>{let e=t%100;return e>10&&e<20?t+" днів":(e%=10,1===e?t+" день":e<5&&e>0?t+" дні":t+" днів")},ru:t=>{let e=t%100;return e>10&&e<20?t+" дней":(e%=10,1===e?t+" день":e<5&&e>0?t+" дня":t+" дней")}},this.columnValueGetters=[t=>t.localizedNames&&t.localizedNames[this.locale]||t.name,t=>(+t.progress.toFixed(2)).toLocaleString("en-US").replace(".",this.localeDecimalSeparator[this.locale]||".")+" %",t=>t.datePlannedStart?t.datePlannedStart.format(this.localeDateFormat[this.locale]||"L"):"",t=>t.datePlannedEnd?t.datePlannedEnd.format(this.localeDateFormat[this.locale]||"L"):"",t=>t.dateActualStart?t.dateActualStart.format(this.localeDateFormat[this.locale]||"L"):"",t=>t.dateActualEnd?t.dateActualEnd.format(this.localeDateFormat[this.locale]||"L"):"",t=>{if(!t.datePlannedEnd||!t.datePlannedStart)return"";const e=t.datePlannedEnd,s=t.datePlannedStart,a=e.diff(s,"day")+1;return this.localeDurationFormatters[this.locale]?this.localeDurationFormatters[this.locale](a):a.toString()},t=>{if(!t.dateActualEnd||!t.dateActualStart)return"";const e=t.dateActualEnd,s=t.dateActualStart,a=e.diff(s,"day")+1;return this.localeDurationFormatters[this.locale]?this.localeDurationFormatters[this.locale](a):a.toString()}],null!=t&&Object.assign(this,t)}}class n{constructor(t,e){const{mode:s,showProgress:a,dayWidth:i,rowHeight:n,barMinWidth:r,barHeight:o,barBorder:d,barCornerR:h,y0:l,y1:c}=e,{datePlannedStart:u,datePlannedEnd:_,dateActualStart:p,dateActualEnd:S}=t,f=u&&_,A=p&&S;let m,E,C;"both"===s?(A||f)&&(A&&f?(m=u.isBefore(p)?u:p,E=_.isAfter(S)?_:S):f?(m=u,E=_):(m=p,E=S),m=m.subtract(1,"day"),C=this.createSvg(m,E,i,r,n),f&&this.createBar(C,m,u.subtract(1,"day"),_,i,r,o,l,d,h,"planned",t.progress,a),A&&this.createBar(C,m,p.subtract(1,"day"),S,i,r,o,c,d,h,"actual",t.progress,a)):"planned"===s&&f?(m=u.subtract(1,"day"),E=_,C=this.createSvg(m,E,i,r,n),this.createBar(C,m,m,E,i,r,o,l,d,h,"planned",t.progress,a)):"actual"===s&&A&&(m=p.subtract(1,"day"),E=S,C=this.createSvg(m,E,i,r,n),this.createBar(C,m,m,E,i,r,o,l,d,h,"actual",t.progress,a)),this.minDate=m,this.maxDate=E,this.barSvg=C,this.task=t}createSvg(e,a,i,n,r){const o=a.diff(e,"day"),d=Math.max(o*i,n);return s("svg",[t.CHART_BAR_GROUP_CLASS],[["width",d+""],["height",r+""]])}createBar(e,a,i,n,r,o,d,h,l,c,u,_,p){const S="planned"===u?[t.CHART_BAR_PLANNED_CLASS]:[t.CHART_BAR_ACTUAL_CLASS],f="planned"===u?[t.CHART_BAR_PLANNED_PROGRESS_CLASS]:[t.CHART_BAR_ACTUAL_PROGRESS_CLASS],A=i.diff(a,"day")*r,m=n.diff(i,"day"),E=Math.max(m*r,o),C=s("svg",[t.CHART_BAR_WRAPPER_CLASS],[["x",A+""],["y",h+""],["width",E+""],["height",d+""]],e),g=l/2,R=E-l,L=d-l;s("rect",S,[["x",g+""],["y",g+""],["width",R+""],["height",L+""],["rx",c+""],["ry",c+""]],C);if(p){const t=R*_/100;s("rect",f,[["x",g+""],["y",g+""],["width",(t<o-l?0:t)+""],["height",L+""],["rx",c+""],["ry",c+""]],C)}}}class r{constructor(t){this._chartBarGroups=[],this._options=t,this._html=this.createChartDiv()}get html(){return this._html}get htmlHeader(){return this._htmlHeader}update(t,e){(!e||this.checkDates(e.all))&&!t||this.refreshHeader(),e&&this.refreshBarGroups(e),this.refreshBody(),this.redraw()}applySelection(e){const{selected:s,deselected:a}=e;if(a){const e=this._chartRowBgs.get(a.uuid);e&&e.classList.remove(t.ROW_SELECTED_CLASS);const s=this._chartRowFgs.get(a.uuid);s&&s.classList.remove(t.ROW_SELECTED_CLASS)}if(s){const e=this._chartRowBgs.get(s.uuid);e&&e.classList.add(t.ROW_SELECTED_CLASS);const a=this._chartRowFgs.get(s.uuid);a&&a.classList.add(t.ROW_SELECTED_CLASS)}}getBarOffsetByTaskUuid(t){return this._chartOffsetsX.get(t)}createChartDiv(){const e=document.createElement("div");return e.classList.add(t.CHART_CLASS),e}checkDates(t){const s=this._dateMinOffset,a=this._dateMaxOffset,i=this._options.chartScale,n=this._options.chartDateOffsetDaysMin[i],r=this._options.chartDateOffsetDays[i];let o=e(),d=e();for(const s of t){const t=e(s.datePlannedStart),a=e(s.datePlannedEnd),i=s.dateActualStart?e(s.dateActualStart):null,n=s.dateActualEnd?e(s.dateActualEnd):null;t.isBefore(o)&&(o=t),a.isAfter(d)&&(d=a),i&&i.isBefore(o)&&(o=i),n&&n.isAfter(d)&&(d=n)}return(!s||s.isAfter(o)||o.diff(s,"day")<n)&&(this._dateMinOffset=o.subtract(r,"day")),(!a||a.isBefore(d)||a.diff(d,"day")<n)&&(this._dateMaxOffset=d.add(r,"day")),this._dateMinOffset===s&&this._dateMaxOffset===a}getBarGroupOptions(){const t=this._options.chartDisplayMode,e=this._options.chartShowProgress,s=this._options.chartDayWidthPx[this._options.chartScale],a=this._options.rowHeightPx,i=this._options.borderWidthPx,n=this._options.barMarginPx,r=this._options.barStrokeWidthPx,o=this._options.barCornerRadiusPx,d=r+2*o,h=n-i/2;let l,c;switch(t){case"both":l=(a-3*n)/2,c=l+2*n-i/2;break;case"planned":case"actual":l=a-2*n}return{mode:t,showProgress:e,dayWidth:s,rowHeight:a,barMinWidth:d,barHeight:l,barBorder:r,barCornerR:o,y0:h,y1:c}}refreshBarGroups(t){const e=this.getBarGroupOptions();t.deleted.forEach(t=>{const e=this._chartBarGroups.findIndex(e=>e.task.uuid===t.uuid);1!==e&&this._chartBarGroups.splice(e,1)}),t.changed.forEach(t=>{const s=this._chartBarGroups.findIndex(e=>e.task.uuid===t.uuid);-1!==s&&(this._chartBarGroups[s]=new n(t,e))}),t.added.forEach(t=>this._chartBarGroups.push(new n(t,e)))}refreshHeader(){const e=this._options.chartScale,a=this._options.chartDayWidthPx[e],i=this._options.headerHeightPx,n=(this._dateMinOffset,this._dateMaxOffset),r=function(t,e){const s=t.startOf("day"),a=e.startOf("day");if(!s||!a||a.diff(s)<0)return[];if(0===a.diff(s))return[s];const i=[];let n=s;for(;n.isBefore(a)||n.isSame(a);)i.push(n),n=n.add(1,"day");return i}(this._dateMinOffset,this._dateMaxOffset),o=r.length*a,d=this._options.locale,h=this._options.localeDateMonths[d],l=this._options.localeDateDaysShort[d],c=(this._options.localeDateDays[d],s("svg",[t.CHART_HEADER_CLASS],[["width",o+""],["height",i+""]]));s("rect",[t.CHART_HEADER_BACKGROUND_CLASS],[["width",o+""],["height",i+""]],c);let u=0,_=0,p=0;const S=[];if("year"===e)for(const e of r){const r=u+a;if(e.isSame(e.endOf("year").startOf("day"))||e.isSame(n)){const a=r-p,n=s("svg",[],[["x",p+""],["y","0"],["width",a+""],["height",i+""]],c);if(a>=60){s("text",[t.CHART_HEADER_TEXT_CLASS],[["x","50%"],["y","50%"],["dominant-baseline","middle"],["text-anchor","middle"]],n,e.year()+"")}s("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1",r+""],["y1","0"],["x2",r+""],["y2",i+""]],c);S.push(r),p=r}u=r}else if("month"===e){const e=i/2,d=0,l=e;s("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1","0"],["y1",l+""],["x2",o+""],["y2",l+""]],c);for(const o of r){const r=u+a;if(o.isSame(o.endOf("year").startOf("day"))||o.isSame(n)){const a=r-p,i=s("svg",[],[["x",p+""],["y",d+""],["width",a+""],["height",e+""]],c);if(a>=60){s("text",[t.CHART_HEADER_TEXT_CLASS],[["x","50%"],["y","50%"],["dominant-baseline","middle"],["text-anchor","middle"]],i,o.year()+"")}s("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1",r+""],["y1",d+""],["x2",r+""],["y2",l+""]],c);p=r}if(o.isSame(o.endOf("month").startOf("day"))||o.isSame(n)){const a=r-_,n=s("svg",[],[["x",_+""],["y",l+""],["width",a+""],["height",e+""]],c);if(a>=60){const e=h[o.month()];s("text",[t.CHART_HEADER_TEXT_CLASS],[["x","50%"],["y","50%"],["dominant-baseline","middle"],["text-anchor","middle"]],n,e)}s("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1",r+""],["y1",l+""],["x2",r+""],["y2",i+""]],c);S.push(r),_=r}u=r}}else if("week"===e||"day"===e){const e=i/3,d=0,f=e,A=2*e;s("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1","0"],["y1",f+""],["x2",o+""],["y2",f+""]],c),s("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1","0"],["y1",A+""],["x2",o+""],["y2",A+""]],c);for(const o of r){const r=u+a;if(o.isSame(o.endOf("year").startOf("day"))||o.isSame(n)){const a=r-p,i=s("svg",[],[["x",p+""],["y",d+""],["width",a+""],["height",e+""]],c);if(a>=60){s("text",[t.CHART_HEADER_TEXT_CLASS],[["x","50%"],["y","50%"],["dominant-baseline","middle"],["text-anchor","middle"]],i,o.year()+"")}s("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1",r+""],["y1",d+""],["x2",r+""],["y2",f+""]],c);p=r}if(o.isSame(o.endOf("month").startOf("day"))||o.isSame(n)){const a=r-_,i=s("svg",[],[["x",_+""],["y",f+""],["width",a+""],["height",e+""]],c);if(a>=60){const e=h[o.month()];s("text",[t.CHART_HEADER_TEXT_CLASS],[["x","50%"],["y","50%"],["dominant-baseline","middle"],["text-anchor","middle"]],i,e)}s("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1",r+""],["y1",f+""],["x2",r+""],["y2",A+""]],c);_=r}const m=s("svg",[],[["x",u+""],["y",A+""],["width",a+""],["height",e+""]],c),E=a<30?o.date()+"":l[o.day()]+" "+o.date();s("text",[t.CHART_HEADER_TEXT_CLASS],[["x","50%"],["y","50%"],["dominant-baseline","middle"],["text-anchor","middle"]],m,E),s("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1",r+""],["y1",A+""],["x2",r+""],["y2",i+""]],c);S.push(r),u=r}}this._width=o,this._headerHeight=i,this._verticalLinesXCoords=S,this._htmlHeader=c}getShownBarGroupsRecursively(t,e){const s=t.filter(t=>t.task.parentUuid===e).sort((t,e)=>t.task.compareTo(e.task)),a=[];for(const e of s)e.task.shown&&(a.push(e),e.task.expanded&&a.push(...this.getShownBarGroupsRecursively(t,e.task.uuid)));return a}refreshBody(){const a=this._options.chartScale,i=this._options.chartDayWidthPx[a],n=this._options.rowHeightPx,r=this._options.borderWidthPx,o=this.getShownBarGroupsRecursively(this._chartBarGroups,null),d=this._dateMinOffset,h=this._verticalLinesXCoords,l=this._width,c=n*o.length,u=this._headerHeight,_=this._options.drawTodayLine,p=s("svg",[t.CHART_BODY_CLASS],[["y",u+""],["width",l+""],["height",c+""]]),S=(s("rect",[t.CHART_BODY_BACKGROUND_CLASS],[["width",l+""],["height",c+""]],p),new Map);o.forEach((e,a)=>{S.set(e.task.uuid,s("rect",[t.CHART_ROW_BACKGROUND_CLASS],[["y",a*n+""],["width",l+""],["height",n+""]],p))});for(let e=0;e<o.length;){const a=++e*n-r/2;s("line",[t.CHART_BODY_GRIDLINES_CLASS],[["x1","0"],["y1",a+""],["x2",l+""],["y2",a+""]],p)}h.forEach(e=>{s("line",[t.CHART_BODY_GRIDLINES_CLASS],[["x1",e+""],["y1","0"],["x2",e+""],["y2",c+""]],p)});const f=e().startOf("day").diff(d,"day")*i,A=new Map,m=new Map;if(o.forEach((e,a)=>{const r=a*n,o=s("svg",[t.CHART_ROW_WRAPPER_CLASS],[["y",r+""],["width",l+""],["height",n+""],["data-tsg-row-uuid",e.task.uuid]],p);o.addEventListener("click",s=>{o.dispatchEvent(new CustomEvent(t.ROW_CLICK,{bubbles:!0,detail:e.task.uuid}))}),A.set(e.task.uuid,o);s("rect",[t.CHART_ROW_CLASS],[["width",l+""],["height",n+""]],o);if(e.barSvg){const t=e.minDate.diff(d,"day")*i;m.set(e.task.uuid,t),e.barSvg.setAttribute("x",t+""),o.append(e.barSvg)}}),_){s("line",[t.CHART_BODY_GRIDLINES_CLASS,t.CHART_BODY_TODAY_LINE_CLASS],[["x1",f+""],["y1","0"],["x2",f+""],["y2",c+""]],p)}this._chartRowBgs=S,this._chartRowFgs=A,this._chartOffsetsX=m,this._htmlBody=p}redraw(){const e=this._html,s=document.createElement("div");s.classList.add(t.CHART_CLASS),s.append(this._htmlHeader,this._htmlBody),e.replaceWith(s),this._html=s}}class o{constructor(t,e,s,a){this.minWidth=t,this.contentAlign=e,this.header=s,this.valueGetter=a;const i=document.createElement("th");i.style.minWidth=this.minWidth+"px",i.innerHTML=this.header,this.html=this.generateHtml()}generateHtml(){const t=document.createElement("th");return t.style.minWidth=this.minWidth+"px",t.innerHTML=this.header,t}}class d{constructor(t,e){this.task=t,this.expander=this.createExpander(),this.html=this.createRow(e)}createRow(e){const s=document.createElement("tr");return s.setAttribute(t.ROW_UUID_ATTRIBUTE,this.task.uuid),s.addEventListener("click",e=>{e.target.classList.contains(t.TABLE_CELL_EXPANDER_CLASS)||s.dispatchEvent(new CustomEvent(t.ROW_CLICK,{bubbles:!0,detail:this.task.uuid}))}),e.forEach((e,a)=>{const i=document.createElement("td"),n=document.createElement("div");if(n.classList.add(t.TABLE_CELL_TEXT_WRAPPER_CLASS,e.contentAlign),0===a){for(let t=0;t<this.task.nestingLvl;t++)n.append(this.createSimpleIndent());n.append(this.expander)}const r=document.createElement("p");r.classList.add(t.TABLE_CELL_TEXT_CLASS),r.innerHTML=e.valueGetter(this.task),n.append(r),i.append(n),s.append(i)}),s}createSimpleIndent(e=""){const s=document.createElement("p");return s.classList.add(t.TABLE_CELL_INDENT_CLASS),s.innerHTML=e,s}createExpander(){const e=document.createElement("p");return e.classList.add(t.TABLE_CELL_EXPANDER_CLASS),e.setAttribute(t.ROW_UUID_ATTRIBUTE,this.task.uuid),this.task.hasChildren&&e.addEventListener("click",s=>{e.dispatchEvent(new CustomEvent(t.CELL_EXPANDER_CLICK,{bubbles:!0,detail:this.task.uuid}))}),e}}class h{constructor(e){this._tableRows=[],this._options=e;const s=document.createElement("table");s.classList.add(t.TABLE_CLASS);const a=s.createTHead(),i=s.createTBody();this._htmlHead=a,this._htmlBody=i,this._html=s,this.updateColumns()}get html(){return this._html}update(t,e){t&&this.updateColumns(),e&&this.updateRows(e),this.redraw()}applySelection(e){const{selected:s,deselected:a}=e;if(a){const e=this._tableRows.find(t=>t.task.uuid===a.uuid);e&&e.html.classList.remove(t.ROW_SELECTED_CLASS)}if(s){const e=this._tableRows.find(t=>t.task.uuid===s.uuid);e&&e.html.classList.add(t.ROW_SELECTED_CLASS)}}updateColumns(){const t=[];for(let e=0;e<9;e++){const s=this._options.columnsMinWidthPx[e],a=this._options.columnsContentAlign[e];s&&t.push(new o(s,a,this._options.localeHeaders[this._options.locale][e]||"",this._options.columnValueGetters[e]||(t=>"")))}this._tableColumns=t}updateRows(t){t.deleted.forEach(t=>{const e=this._tableRows.findIndex(e=>e.task.uuid===t.uuid);1!==e&&this._tableRows.splice(e,1)}),t.changed.forEach(t=>{const e=this._tableRows.findIndex(e=>e.task.uuid===t.uuid);-1!==e&&(this._tableRows[e]=new d(t,this._tableColumns))}),t.added.forEach(t=>this._tableRows.push(new d(t,this._tableColumns)))}redraw(){const t=document.createElement("tr");this._tableColumns.forEach(e=>t.append(e.html)),this._htmlHead.innerHTML="",this._htmlHead.append(t),this._htmlBody.innerHTML="",this._htmlBody.append(...this.getRowsHtmlRecursively(this._tableRows,null))}getRowsHtmlRecursively(t,e){const s=this._options.rowSymbols,a=t.filter(t=>t.task.parentUuid===e).sort((t,e)=>t.task.compareTo(e.task)),i=[];for(const e of a)e.task.shown&&(i.push(e.html),e.task.hasChildren?e.task.expanded?(e.expander.innerHTML=s.expanded,i.push(...this.getRowsHtmlRecursively(t,e.task.uuid))):e.expander.innerHTML=s.collapsed:e.expander.innerHTML=s.childless);return i}}class l{constructor(t,e){if(this._tasks=[],this._htmlSeparatorDragActive=!1,this._ignoreNextScrollEvent=!1,this.onResize=t=>{const e=this._htmlWrapper.getBoundingClientRect().width,s=this._htmlTableWrapper.getBoundingClientRect().width;this._htmlChartWrapper.style.width=e-s-this._options.separatorWidthPx+"px"},this.onMouseDownOnSep=t=>{t.target===this._htmlSeparator&&(this._htmlSeparatorDragActive=!0)},this.onMouseMoveOnSep=t=>{if(!this._htmlSeparatorDragActive)return!1;const e=this._htmlWrapper.offsetLeft,s=this._htmlWrapper.getBoundingClientRect().width,a=t.clientX-e;this._htmlTableWrapper.style.width=a-this._options.separatorWidthPx+"px",this._htmlChartWrapper.style.width=s-a+"px"},this.onMouseUpOnSep=t=>{this._htmlSeparatorDragActive=!1},this.onWrapperScroll=t=>{if(this._ignoreNextScrollEvent)return void(this._ignoreNextScrollEvent=!1);this._ignoreNextScrollEvent=!0;const e=t.currentTarget,s=e.scrollTop;e===this._htmlTableWrapper?this._htmlChartWrapper.scrollTop!==s&&(this._htmlChartWrapper.scrollTop=s):e===this._htmlChartWrapper&&this._htmlTableWrapper.scrollTop!==s&&(this._htmlTableWrapper.scrollTop=s)},this.onRowClick=t=>{const e=this._tasks.find(e=>e.uuid===t.detail);this.selectTask(e)},this.onRowExpanderClick=t=>{this.toggleTaskExpanded(t.detail)},this._options=new i(e),this.setCssVariables(this._options),this._htmlContainer=document.querySelector(t),!this._htmlContainer)throw new Error("Container is null");this.createLayout()}get tasks(){return a.convertTasksToModels(this._tasks)}set tasks(t){const e=this.updateTasks(t),s=a.detectTaskChanges(e);this.update(s)}get selectedTask(){return this._selectedTask?a.convertTasksToModels([this._selectedTask])[0]:null}set selectedTask(t){const e=this._tasks.find(e=>e.externalId===t.id);e!==this._selectedTask&&this.selectTask(e)}set locale(t){t!==this._options.locale&&(this._options.locale=t,this.updateLocale())}set chartScale(t){t!==this._options.chartScale&&(this._options.chartScale=t,this.updateChartScale())}set chartDisplayMode(t){t!==this._options.chartDisplayMode&&(this._options.chartDisplayMode=t,this.updateChartDisplayMode())}destroy(){this.removeResizeEventListeners(),this.removeRowEventListeners(),this._htmlWrapper.remove()}removeResizeEventListeners(){window.removeEventListener("resize",this.onResize),document.removeEventListener("mousedown",this.onMouseDownOnSep),document.removeEventListener("mousemove",this.onMouseMoveOnSep),document.removeEventListener("mouseup",this.onMouseUpOnSep)}removeRowEventListeners(){document.removeEventListener(t.ROW_CLICK,this.onRowClick),document.removeEventListener(t.CELL_EXPANDER_CLICK,this.onRowExpanderClick)}setCssVariables(e){document.documentElement.style.setProperty(t.CSS_VAR_SEPARATOR_WIDTH,e.separatorWidthPx+"px"),document.documentElement.style.setProperty(t.CSS_VAR_HEADER_HEIGHT,e.headerHeightPx+"px"),document.documentElement.style.setProperty(t.CSS_VAR_ROW_HEIGHT,e.rowHeightPx+"px"),document.documentElement.style.setProperty(t.CSS_VAR_GRIDLINES_WIDTH,e.borderWidthPx+"px"),document.documentElement.style.setProperty(t.CSS_VAR_BAR_STROKE_WIDTH,e.barStrokeWidthPx+"px")}createLayout(){const e=document.createElement("div");e.classList.add(t.WRAPPER_CLASS);const s=document.createElement("div");s.classList.add(t.TABLE_WRAPPER_CLASS);const a=document.createElement("div");a.classList.add(t.CHART_WRAPPER_CLASS);const i=document.createElement("div");i.classList.add(t.SEPARATOR_CLASS),this._table=new h(this._options),this._chart=new r(this._options),e.append(s),e.append(i),e.append(a),s.append(this._table.html),a.append(this._chart.html),s.addEventListener("scroll",this.onWrapperScroll),a.addEventListener("scroll",this.onWrapperScroll),this._htmlContainer.append(e),this._htmlWrapper=e,this._htmlTableWrapper=s,this._htmlChartWrapper=a,this._htmlSeparator=i,window.addEventListener("resize",this.onResize),document.addEventListener("mousedown",this.onMouseDownOnSep),document.addEventListener("mousemove",this.onMouseMoveOnSep),document.addEventListener("mouseup",this.onMouseUpOnSep),document.addEventListener(t.ROW_CLICK,this.onRowClick),document.addEventListener(t.CELL_EXPANDER_CLICK,this.onRowExpanderClick)}updateTasks(t){const e=this._tasks,s=a.getTasksIdsMap(e),i=a.convertModelsToTasks(t,s);return this._tasks=i,{oldTasks:e,newTasks:i}}toggleTaskExpanded(t){let e;const s=[];for(const a of this._tasks)e||a.uuid!==t?a.parentUuid===t&&s.push(a):e=a;e&&(e.expanded=!e.expanded,s.forEach(t=>t.shown=!t.shown),this.update(null))}selectTask(t,e=!1){const s=this._selectedTask;(e||(s||t)&&s!==t)&&(this._selectedTask=t,this._table.applySelection({selected:t,deselected:s}),this._chart.applySelection({selected:t,deselected:s}),t&&this.scrollChartToTask(t.uuid))}scrollChartToTask(t){const e=this._chart.getBarOffsetByTaskUuid(t);e&&(this._htmlChartWrapper.scrollLeft=e-20)}update(t){this._table.update(!1,t),this._chart.update(!1,t),this.refreshSelection()}updateLocale(){const t={deleted:[],added:[],changed:this._tasks,all:this._tasks};this._table.update(!0,t),this._chart.update(!0,t)}updateChartScale(){this._chart.update(!0,{deleted:[],added:[],changed:this._tasks,all:this._tasks}),this.refreshSelection()}updateChartDisplayMode(){this._chart.update(!1,{deleted:[],added:[],changed:this._tasks,all:this._tasks}),this.refreshSelection()}refreshSelection(){this._selectedTask&&(this._tasks.filter(t=>t.shown).find(t=>t.uuid===this._selectedTask.uuid)?this.selectTask(this._selectedTask,!0):this.selectTask(null))}}export{l as TsGantt,i as TsGanttOptions};
