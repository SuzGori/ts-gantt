class t{}function e(t,e=[],s=[],n=null,a=null){const i=document.createElementNS("http://www.w3.org/2000/svg",t);for(const t of s)i.setAttribute(t[0],t[1]);return 0!==e.length&&i.classList.add(...e),a&&(i.innerHTML=a),n&&n.append(i),i}t.WRAPPER_CLASS="tsg-wrapper",t.FOOTER_CLASS="tsg-footer",t.TABLE_WRAPPER_CLASS="tsg-table-wrapper",t.CHART_WRAPPER_CLASS="tsg-chart-wrapper",t.TABLE_CLASS="tsg-table",t.CHART_CLASS="tsg-chart",t.SEPARATOR_CLASS="tsg-separator",t.ROW_UUID_ATTRIBUTE="data-tsg-row-uuid",t.ROW_UUID_DATASET_KEY="tsgRowUuid",t.ROW_SELECTED_CLASS="selected",t.ROW_CLICK="tsgrowclick",t.TABLE_CELL_TEXT_WRAPPER_CLASS="tsg-cell-text-wrapper",t.TABLE_CELL_TEXT_CLASS="tsg-cell-text",t.TABLE_CELL_INDENT_CLASS="tsg-cell-text-indent",t.TABLE_CELL_EXPANDER_CLASS="tsg-cell-text-expander",t.CELL_EXPANDER_CLICK="tsgexpanderclick",t.CELL_EXPANDER_SYMBOL="◆",t.CELL_EXPANDER_EXPANDABLE_SYMBOL="⬘",t.CELL_EXPANDER_EXPANDED_SYMBOL="⬙",t.CHART_HEADER_CLASS="tsg-chart-header",t.CHART_HEADER_BACKGROUND_CLASS="tsg-chart-header-bg",t.CHART_HEADER_GRIDLINES_CLASS="tsg-chart-header-gl",t.CHART_HEADER_TEXT_CLASS="tsg-chart-header-text",t.CHART_BODY_CLASS="tsg-chart-body",t.CHART_BODY_BACKGROUND_CLASS="tsg-chart-body-bg",t.CHART_BODY_GRIDLINES_CLASS="tsg-chart-body-gl";class s{constructor(t,e,s,n,a,i,r=null,d=null,o={}){this.id=t,this.parentId=e,this.name=s,this.localizedNames=o,this.progress=n>100?100:n<0?0:n,this.datePlannedStart=a,this.datePlannedEnd=i,this.dateActualStart=r,this.dateActualEnd=d}}class n{constructor(t,e,s,n,a,i,r,d=null,o=null,h=0,l=!1,u=null,c=null){this._progress=0,this.externalId=t,this.parentExternalId=e,this.name=s,this.localizedNames=n,this.progress=a,this.datePlannedStart=i,this.datePlannedEnd=r,this.dateActualStart=d,this.dateActualEnd=o,this.nestingLvl=h,this.hasChildren=l,this.parentUuid=u,this.uuid=c||crypto.getRandomValues(new Uint32Array(4)).join("-"),this.shown=!u,this.expanded=!1,this.selected=!1}set progress(t){this._progress=t<0?0:t>100?100:t}get progress(){return this._progress}static convertModelsToTasks(t,e=new Map){const s=t.slice(),a=new Set(s.map(t=>t.parentId)),i=[];let r=[];for(let t=s.length-1;t>=0;t--){const d=s[t];if(null===d.parentId){const o=new n(d.id,d.parentId,d.name,d.localizedNames,d.progress,d.datePlannedStart,d.datePlannedEnd,d.dateActualStart,d.dateActualEnd,0,a.has(d.id),null,e.get(d.id));i.push(o),r.push(o),s.splice(t,1)}}let d=1;for(;0!==s.length||0!==r.length;){const t=[];r.filter(t=>t.hasChildren).forEach(r=>{for(let o=s.length-1;o>=0;o--){const h=s[o];if(h.parentId===r.externalId){const l=new n(h.id,h.parentId,h.name,h.localizedNames,h.progress,h.datePlannedStart,h.datePlannedEnd,h.dateActualStart,h.dateActualEnd,d,a.has(h.id),r.uuid,e.get(h.id));i.push(l),t.push(l),s.splice(o,1)}}}),r=t,d++}return i}static convertTasksToModels(t){return t.map(t=>new s(t.externalId,t.parentExternalId,t.name,t.progress,t.datePlannedStart,t.datePlannedEnd,t.dateActualStart,t.dateActualEnd,t.localizedNames))}static detectTaskChanges(t){const{oldTasks:e,newTasks:s}=t,n=e.map(t=>t.uuid),a=s.map(t=>t.uuid),i=e.filter(t=>!a.includes(t.uuid)),r=[],d=[];for(const t of s){if(!n.includes(t.uuid)){r.push(t);continue}const s=e.find(e=>e.uuid===t.uuid);t.equals(s)||d.push(t)}return{deleted:i,added:r,changed:d,all:s}}static getTasksIdsMap(t){const e=new Map;for(const s of t)e.has(s.externalId)||e.set(s.externalId,s.uuid);return e}static checkPaternity(t,e,s){var n;let a=s.parentUuid;for(;a;){if(a===e.uuid)return!0;a=null===(n=t.find(t=>t.uuid===a))||void 0===n?void 0:n.parentUuid}return!1}equals(t){var e,s,n,a,i,r,d,o;return this.uuid===t.uuid&&this.parentUuid===t.parentUuid&&this.nestingLvl===t.nestingLvl&&this.hasChildren===t.hasChildren&&this.name===t.name&&this.progress===t.progress&&(null===(e=this.datePlannedStart)||void 0===e?void 0:e.getTime())===(null===(s=t.datePlannedStart)||void 0===s?void 0:s.getTime())&&(null===(n=this.datePlannedEnd)||void 0===n?void 0:n.getTime())===(null===(a=t.datePlannedEnd)||void 0===a?void 0:a.getTime())&&(null===(i=this.dateActualStart)||void 0===i?void 0:i.getTime())===(null===(r=t.dateActualStart)||void 0===r?void 0:r.getTime())&&(null===(d=this.dateActualEnd)||void 0===d?void 0:d.getTime())===(null===(o=t.dateActualEnd)||void 0===o?void 0:o.getTime())&&this.expanded===t.expanded&&this.shown===t.shown&&this.selected===t.selected}compareTo(t){var e,s,n,a,i,r,d,o,h,l,u,c,_,m,f,p;return this.nestingLvl>t.nestingLvl?1:this.nestingLvl<t.nestingLvl?-1:(null===(e=this.datePlannedStart)||void 0===e?void 0:e.getTime())>(null===(s=t.datePlannedStart)||void 0===s?void 0:s.getTime())?1:(null===(n=this.datePlannedStart)||void 0===n?void 0:n.getTime())<(null===(a=t.datePlannedStart)||void 0===a?void 0:a.getTime())?-1:(null===(i=this.datePlannedEnd)||void 0===i?void 0:i.getTime())>(null===(r=t.datePlannedEnd)||void 0===r?void 0:r.getTime())?1:(null===(d=this.datePlannedEnd)||void 0===d?void 0:d.getTime())<(null===(o=t.datePlannedEnd)||void 0===o?void 0:o.getTime())?-1:(null===(h=this.dateActualStart)||void 0===h?void 0:h.getTime())>(null===(l=t.dateActualStart)||void 0===l?void 0:l.getTime())?1:(null===(u=this.dateActualStart)||void 0===u?void 0:u.getTime())<(null===(c=t.dateActualStart)||void 0===c?void 0:c.getTime())?-1:(null===(_=this.dateActualEnd)||void 0===_?void 0:_.getTime())>(null===(m=t.dateActualEnd)||void 0===m?void 0:m.getTime())?1:(null===(f=this.dateActualEnd)||void 0===f?void 0:f.getTime())<(null===(p=t.dateActualEnd)||void 0===p?void 0:p.getTime())?-1:0}}class a{}class i{}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var r=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t,e){t.exports=function(){var t="millisecond",e="second",s="minute",n="hour",a="day",i="week",r="month",d="quarter",o="year",h=/^(\d{4})-?(\d{1,2})-?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?.?(\d{1,3})?$/,l=/\[([^\]]+)]|Y{2,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,u=function(t,e,s){var n=String(t);return!n||n.length>=e?t:""+Array(e+1-n.length).join(s)+t},c={s:u,z:function(t){var e=-t.utcOffset(),s=Math.abs(e),n=Math.floor(s/60),a=s%60;return(e<=0?"+":"-")+u(n,2,"0")+":"+u(a,2,"0")},m:function(t,e){var s=12*(e.year()-t.year())+(e.month()-t.month()),n=t.clone().add(s,r),a=e-n<0,i=t.clone().add(s+(a?-1:1),r);return Number(-(s+(e-n)/(a?n-i:i-n))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(h){return{M:r,y:o,w:i,d:a,D:"date",h:n,m:s,s:e,ms:t,Q:d}[h]||String(h||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},_={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},m="en",f={};f[m]=_;var p=function(t){return t instanceof g},S=function(t,e,s){var n;if(!t)return m;if("string"==typeof t)f[t]&&(n=t),e&&(f[t]=e,n=t);else{var a=t.name;f[a]=t,n=a}return!s&&n&&(m=n),n||!s&&m},E=function(t,e,s){if(p(t))return t.clone();var n=e?"string"==typeof e?{format:e,pl:s}:e:{};return n.date=t,new g(n)},A=c;A.l=S,A.i=p,A.w=function(t,e){return E(t,{locale:e.$L,utc:e.$u,$offset:e.$offset})};var g=function(){function u(t){this.$L=this.$L||S(t.locale,null,!0),this.parse(t)}var c=u.prototype;return c.parse=function(t){this.$d=function(t){var e=t.date,s=t.utc;if(null===e)return new Date(NaN);if(A.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var n=e.match(h);if(n)return s?new Date(Date.UTC(n[1],n[2]-1,n[3]||1,n[4]||0,n[5]||0,n[6]||0,n[7]||0)):new Date(n[1],n[2]-1,n[3]||1,n[4]||0,n[5]||0,n[6]||0,n[7]||0)}return new Date(e)}(t),this.init()},c.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},c.$utils=function(){return A},c.isValid=function(){return!("Invalid Date"===this.$d.toString())},c.isSame=function(t,e){var s=E(t);return this.startOf(e)<=s&&s<=this.endOf(e)},c.isAfter=function(t,e){return E(t)<this.startOf(e)},c.isBefore=function(t,e){return this.endOf(e)<E(t)},c.$g=function(t,e,s){return A.u(t)?this[e]:this.set(s,t)},c.year=function(t){return this.$g(t,"$y",o)},c.month=function(t){return this.$g(t,"$M",r)},c.day=function(t){return this.$g(t,"$W",a)},c.date=function(t){return this.$g(t,"$D","date")},c.hour=function(t){return this.$g(t,"$H",n)},c.minute=function(t){return this.$g(t,"$m",s)},c.second=function(t){return this.$g(t,"$s",e)},c.millisecond=function(e){return this.$g(e,"$ms",t)},c.unix=function(){return Math.floor(this.valueOf()/1e3)},c.valueOf=function(){return this.$d.getTime()},c.startOf=function(t,d){var h=this,l=!!A.u(d)||d,u=A.p(t),c=function(t,e){var s=A.w(h.$u?Date.UTC(h.$y,e,t):new Date(h.$y,e,t),h);return l?s:s.endOf(a)},_=function(t,e){return A.w(h.toDate()[t].apply(h.toDate(),(l?[0,0,0,0]:[23,59,59,999]).slice(e)),h)},m=this.$W,f=this.$M,p=this.$D,S="set"+(this.$u?"UTC":"");switch(u){case o:return l?c(1,0):c(31,11);case r:return l?c(1,f):c(0,f+1);case i:var E=this.$locale().weekStart||0,g=(m<E?m+7:m)-E;return c(l?p-g:p+(6-g),f);case a:case"date":return _(S+"Hours",0);case n:return _(S+"Minutes",1);case s:return _(S+"Seconds",2);case e:return _(S+"Milliseconds",3);default:return this.clone()}},c.endOf=function(t){return this.startOf(t,!1)},c.$set=function(i,d){var h,l=A.p(i),u="set"+(this.$u?"UTC":""),c=(h={},h.day=u+"Date",h.date=u+"Date",h[r]=u+"Month",h[o]=u+"FullYear",h[n]=u+"Hours",h[s]=u+"Minutes",h[e]=u+"Seconds",h[t]=u+"Milliseconds",h)[l],_=l===a?this.$D+(d-this.$W):d;if(l===r||l===o){var m=this.clone().set("date",1);m.$d[c](_),m.init(),this.$d=m.set("date",Math.min(this.$D,m.daysInMonth())).toDate()}else c&&this.$d[c](_);return this.init(),this},c.set=function(t,e){return this.clone().$set(t,e)},c.get=function(t){return this[A.p(t)]()},c.add=function(t,d){var h,l=this;t=Number(t);var u=A.p(d),c=function(e){var s=E(l);return A.w(s.date(s.date()+Math.round(e*t)),l)};if(u===r)return this.set(r,this.$M+t);if(u===o)return this.set(o,this.$y+t);if(u===a)return c(1);if(u===i)return c(7);var _=(h={},h[s]=6e4,h[n]=36e5,h[e]=1e3,h)[u]||1,m=this.$d.getTime()+t*_;return A.w(m,this)},c.subtract=function(t,e){return this.add(-1*t,e)},c.format=function(t){var e=this;if(!this.isValid())return"Invalid Date";var s=t||"YYYY-MM-DDTHH:mm:ssZ",n=A.z(this),a=this.$locale(),i=this.$H,r=this.$m,d=this.$M,o=a.weekdays,h=a.months,u=function(t,n,a,i){return t&&(t[n]||t(e,s))||a[n].substr(0,i)},c=function(t){return A.s(i%12||12,t,"0")},_=a.meridiem||function(t,e,s){var n=t<12?"AM":"PM";return s?n.toLowerCase():n},m={YY:String(this.$y).slice(-2),YYYY:this.$y,M:d+1,MM:A.s(d+1,2,"0"),MMM:u(a.monthsShort,d,h,3),MMMM:h[d]||h(this,s),D:this.$D,DD:A.s(this.$D,2,"0"),d:String(this.$W),dd:u(a.weekdaysMin,this.$W,o,2),ddd:u(a.weekdaysShort,this.$W,o,3),dddd:o[this.$W],H:String(i),HH:A.s(i,2,"0"),h:c(1),hh:c(2),a:_(i,r,!0),A:_(i,r,!1),m:String(r),mm:A.s(r,2,"0"),s:String(this.$s),ss:A.s(this.$s,2,"0"),SSS:A.s(this.$ms,3,"0"),Z:n};return s.replace(l,(function(t,e){return e||m[t]||n.replace(":","")}))},c.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},c.diff=function(t,a,h){var l,u=A.p(a),c=E(t),_=6e4*(c.utcOffset()-this.utcOffset()),m=this-c,f=A.m(this,c);return f=(l={},l[o]=f/12,l[r]=f,l[d]=f/3,l[i]=(m-_)/6048e5,l.day=(m-_)/864e5,l[n]=m/36e5,l[s]=m/6e4,l[e]=m/1e3,l)[u]||m,h?f:A.a(f)},c.daysInMonth=function(){return this.endOf(r).$D},c.$locale=function(){return f[this.$L]},c.locale=function(t,e){if(!t)return this.$L;var s=this.clone(),n=S(t,e,!0);return n&&(s.$L=n),s},c.clone=function(){return A.w(this.$d,this)},c.toDate=function(){return new Date(this.valueOf())},c.toJSON=function(){return this.isValid()?this.toISOString():null},c.toISOString=function(){return this.$d.toISOString()},c.toString=function(){return this.$d.toUTCString()},u}();return E.prototype=g.prototype,E.extend=function(t,e){return t(e,g,E),E},E.locale=S,E.isDayjs=p,E.unix=function(t){return E(1e3*t)},E.en=f[m],E.Ls=f,E}()}));class d{constructor(t=null){this.enableChartEdit=!1,this.enablePlannedDatesEdit=!0,this.enableActualDatesEdit=!0,this.bindParentDatesToChild=!0,this.enableProgressEdit=!0,this.columnsMinWidthPx=[200,100,100,100,100,100,100,100],this.columnsContentAlign=["start","end","center","center","center","center","center","center"],this.chartHeaderHeightPx=90,this.chartRowHeightPx=40,this.chartBarFontSizePx=12,this.chartBarHeightPx=16,this.chartBarMode="both",this.chartScale="month",this.chartDateOffsetDays={day:14,week:60,month:240,year:730},this.chartDateOffsetDaysMin={day:7,week:30,month:120,year:365},this.chartDayWidthPx={day:60,week:20,month:3,year:1},this.locale="en",this.localeDecimalSeparator={en:".",uk:",",ru:","},this.localeDateFormat={en:"MM/DD/YYYY",uk:"DD.MM.YYYY",ru:"DD.MM.YYYY"},this.localeFirstWeekDay={en:0,uk:1,ru:1},this.localeDateMonths={en:["January","February","March","April","May","June","July","August","September","October","November","December"],uk:["Січень","Лютий","Березень","Квітень","Травень","Червень","Липень","Серпень","Вересень","Жовтень","Листопад","Грудень"],ru:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"]},this.localeDateDays={en:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],uk:["Неділя","Понеділок","Вівторок","Середа","Четвер","П'ятниця","Субота"],ru:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"]},this.localeDateDaysShort={en:["Su","Mo","Tu","We","Th","Fr","Sa"],uk:["Нд","Пн","Вт","Ср","Чт","Пт","Сб"],ru:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"]},this.localeDateScale={en:["Weeks","Months","Years"],uk:["Тижні","Місяці","Роки"],ru:["Недели","Месяцы","Годы"]},this.localeFooters={en:["Total tasks","Completed"],uk:["Всього задач","Завершено"],ru:["Всего задач","Завершено"]},this.localeHeaders={en:["Name","Progress","Start date planned","End date planned","Start date actual","End date actual","Duration planned","Duration actual"],uk:["Ім'я","Прогрес","Дата початку планована","Дата завершення планована","Дата початку фактична","Дата завершення фактична","Тривалість планована","Тривалість фактична"],ru:["Имя","Прогресс","Дата начала планируемая","Дата окончания планируемая","Дата начала фактическая","Дата окончания фактическая","Длительность планируемая","Длительность фактическая"]},this.localeDurationFormatters={en:t=>1===t?"1 day":t+" days",uk:t=>{let e=t%100;return e>10&&e<20?e+" днів":(e%=10,1===e?e+" день":e<5?e+" дні":e+" днів")},ru:t=>{let e=t%100;return e>10&&e<20?e+" дней":(e%=10,1===e?e+" день":e<5?e+" дня":e+" дней")}},this.columnValueGetters=[(t=>t.localizedNames[this.locale]||t.name).bind(this),(t=>(+t.progress.toFixed(2)).toLocaleString("en-US").replace(".",this.localeDecimalSeparator[this.locale]||".")).bind(this),(t=>r(t.datePlannedStart).format(this.localeDateFormat[this.locale]||"L")).bind(this),(t=>r(t.datePlannedEnd).format(this.localeDateFormat[this.locale]||"L")).bind(this),(t=>t.dateActualStart?r(t.dateActualStart).format(this.localeDateFormat[this.locale]||"L"):"").bind(this),(t=>t.dateActualEnd?r(t.dateActualEnd).format(this.localeDateFormat[this.locale]||"L"):"").bind(this),(t=>{const e=r(t.datePlannedEnd),s=r(t.datePlannedStart),n=e.diff(s,"day")+1;return this.localeDurationFormatters[this.locale]?this.localeDurationFormatters[this.locale](n):n.toString()}).bind(this),(t=>{if(!t.dateActualEnd||!t.dateActualStart)return"";const e=r(t.dateActualEnd),s=r(t.dateActualStart),n=e.diff(s,"day")+1;return this.localeDurationFormatters[this.locale]?this.localeDurationFormatters[this.locale](n):n.toString()}).bind(this)],null!=t&&Object.assign(this,t)}}class o{constructor(s){this._chartBarGroups=[],this._chartBarGroupsShown=[],this._chartRows=[],this._options=s;const n=e("svg",[t.CHART_CLASS]);this._html=n}get html(){return this._html}update(t,e){this.checkDates(e.all)&&!t||this.refreshHeader(),this.refreshBody(),this.redraw()}checkDates(t){const e=this._dateMinOffset,s=this._dateMaxOffset,n=this._options.chartScale,a=this._options.chartDateOffsetDaysMin[n],i=this._options.chartDateOffsetDays[n];let d=r(),o=r();for(const e of t){const t=r(e.datePlannedStart),s=r(e.datePlannedEnd),n=e.dateActualStart?r(e.dateActualStart):null,a=e.dateActualEnd?r(e.dateActualEnd):null;t.isBefore(d)&&(d=t),s.isAfter(o)&&(o=s),n&&n.isBefore(d)&&(d=n),a&&a.isAfter(o)&&(o=a)}return this._dateMin=d,this._dateMax=o,(!e||e.isAfter(d)||d.diff(e,"day")<a)&&(this._dateMinOffset=d.subtract(i,"day")),(!s||s.isBefore(o)||s.diff(o,"day")<a)&&(this._dateMaxOffset=o.add(i,"day")),this._dateMinOffset===e&&this._dateMaxOffset===s}refreshHeader(){const s=this._options.chartScale,n=this._options.chartDayWidthPx[s],a=this._options.chartHeaderHeightPx,i=(this._dateMinOffset,this._dateMaxOffset),r=function(t,e){const s=t.startOf("day"),n=e.startOf("day");if(!s||!n||n.diff(s)<0)return[];if(0===n.diff(s))return[s];const a=[];let i=s;for(;i.isBefore(n)||i.isSame(n);)a.push(i),i=i.add(1,"day");return a}(this._dateMinOffset,this._dateMaxOffset),d=r.length*n,o=this._options.locale,h=this._options.localeDateMonths[o],l=this._options.localeDateDaysShort[o],u=(this._options.localeDateDays[o],e("svg",[t.CHART_HEADER_CLASS],[["width",d+""],["height",a+""]]));e("rect",[t.CHART_HEADER_BACKGROUND_CLASS],[["width",d+""],["height",a+""]],u);let c=0,_=0,m=0;if("year"===s)for(const s of r){const r=c+n;if(s.isSame(s.endOf("year").startOf("day"))||s.isSame(i)){const n=r-m,i=e("svg",[],[["x",m+""],["y","0"],["width",n+""],["height",a+""]],u);if(n>=60){e("text",[t.CHART_HEADER_TEXT_CLASS],[["x","50%"],["y","50%"],["dominant-baseline","middle"],["text-anchor","middle"]],i,s.year()+"")}e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1",r+""],["y1","0"],["x2",r+""],["y2",a+""]],u);m=r}c=r}else if("month"===s){const s=a/2,o=0,l=s;e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1","0"],["y1",l+""],["x2",d+""],["y2",l+""]],u);for(const d of r){const r=c+n;if(d.isSame(d.endOf("year").startOf("day"))||d.isSame(i)){const n=r-m,a=e("svg",[],[["x",m+""],["y",o+""],["width",n+""],["height",s+""]],u);if(n>=60){e("text",[t.CHART_HEADER_TEXT_CLASS],[["x","50%"],["y","50%"],["dominant-baseline","middle"],["text-anchor","middle"]],a,d.year()+"")}e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1",r+""],["y1",o+""],["x2",r+""],["y2",l+""]],u);m=r}if(d.isSame(d.endOf("month").startOf("day"))||d.isSame(i)){const n=r-_,i=e("svg",[],[["x",_+""],["y",l+""],["width",n+""],["height",s+""]],u);if(n>=60){const s=h[d.month()];e("text",[t.CHART_HEADER_TEXT_CLASS],[["x","50%"],["y","50%"],["dominant-baseline","middle"],["text-anchor","middle"]],i,s)}e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1",r+""],["y1",l+""],["x2",r+""],["y2",a+""]],u);_=r}c=r}}else if("week"===s||"day"===s){const s=a/3,o=0,f=s,p=2*s;e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1","0"],["y1",f+""],["x2",d+""],["y2",f+""]],u),e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1","0"],["y1",p+""],["x2",d+""],["y2",p+""]],u);for(const d of r){const r=c+n;if(d.isSame(d.endOf("year").startOf("day"))||d.isSame(i)){const n=r-m,a=e("svg",[],[["x",m+""],["y",o+""],["width",n+""],["height",s+""]],u);if(n>=60){e("text",[t.CHART_HEADER_TEXT_CLASS],[["x","50%"],["y","50%"],["dominant-baseline","middle"],["text-anchor","middle"]],a,d.year()+"")}e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1",r+""],["y1",o+""],["x2",r+""],["y2",f+""]],u);m=r}if(d.isSame(d.endOf("month").startOf("day"))||d.isSame(i)){const n=r-_,a=e("svg",[],[["x",_+""],["y",f+""],["width",n+""],["height",s+""]],u);if(n>=60){const s=h[d.month()];e("text",[t.CHART_HEADER_TEXT_CLASS],[["x","50%"],["y","50%"],["dominant-baseline","middle"],["text-anchor","middle"]],a,s)}e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1",r+""],["y1",f+""],["x2",r+""],["y2",p+""]],u);_=r}const S=e("svg",[],[["x",c+""],["y",p+""],["width",n+""],["height",s+""]],u),E=n<30?d.date()+"":l[d.day()]+" "+d.date();e("text",[t.CHART_HEADER_TEXT_CLASS],[["x","50%"],["y","50%"],["dominant-baseline","middle"],["text-anchor","middle"]],S,E),e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1",r+""],["y1",p+""],["x2",r+""],["y2",a+""]],u);c=r}}this._width=d,this._headerHeight=a,this._htmlHeader=u}refreshBody(){const s=this._options.chartScale,n=(this._options.chartDayWidthPx[s],this._width,e("svg",[t.CHART_BODY_CLASS]));this._bodyHeight=0,this._htmlBody=n}redraw(){const s=this._headerHeight+this._bodyHeight,n=this._html,a=e("svg",[t.CHART_CLASS],[["width",this._width+""],["height",s+""]]);a.append(this._htmlHeader,this._htmlBody),n.replaceWith(a),this._html=a}}class h{constructor(t,e,s,n){this.minWidth=t,this.contentAlign=e,this.header=s,this.valueGetter=n;const a=document.createElement("th");a.style.minWidth=this.minWidth+"px",a.innerHTML=this.header,this.html=this.generateHtml()}generateHtml(){const t=document.createElement("th");return t.style.minWidth=this.minWidth+"px",t.innerHTML=this.header,t}}class l{constructor(t,e){this.task=t,this.html=this.generateHtml(e)}generateHtml(e){const s=document.createElement("tr");return s.setAttribute(t.ROW_UUID_ATTRIBUTE,this.task.uuid),s.addEventListener("click",e=>{e.target.classList.contains(t.TABLE_CELL_EXPANDER_CLASS)||s.dispatchEvent(new Event(t.ROW_CLICK,{bubbles:!0}))}),this.task.selected&&s.classList.add(t.ROW_SELECTED_CLASS),e.forEach((e,n)=>{const a=document.createElement("td"),i=document.createElement("div");if(i.classList.add(t.TABLE_CELL_TEXT_WRAPPER_CLASS,e.contentAlign),0===n){for(let t=0;t<this.task.nestingLvl;t++)i.append(this.createSimpleIndent());if(this.task.hasChildren){const e=document.createElement("p");e.classList.add(t.TABLE_CELL_EXPANDER_CLASS),e.setAttribute(t.ROW_UUID_ATTRIBUTE,this.task.uuid),e.innerHTML=this.task.expanded?t.CELL_EXPANDER_EXPANDED_SYMBOL:t.CELL_EXPANDER_EXPANDABLE_SYMBOL,e.addEventListener("click",s=>{e.dispatchEvent(new Event(t.CELL_EXPANDER_CLICK,{bubbles:!0}))}),i.append(e)}else i.append(this.createSimpleIndent(t.CELL_EXPANDER_SYMBOL))}const r=document.createElement("p");r.classList.add(t.TABLE_CELL_TEXT_CLASS),r.innerHTML=e.valueGetter(this.task),i.append(r),a.append(i),s.append(a)}),s}createSimpleIndent(e=""){const s=document.createElement("p");return s.classList.add(t.TABLE_CELL_INDENT_CLASS),s.innerHTML=e,s}}class u{constructor(e){this._tableRows=[],this._options=e;const s=document.createElement("table");s.classList.add(t.TABLE_CLASS);const n=s.createTHead(),a=s.createTBody();this._htmlHead=n,this._htmlBody=a,this._html=s,this.updateColumns()}get html(){return this._html}update(t,e){t&&this.updateColumns(),e&&this.updateRows(e)}updateColumns(){const t=[];for(let e=0;e<9;e++){const s=this._options.columnsMinWidthPx[e],n=this._options.columnsContentAlign[e];s&&t.push(new h(s,n,this._options.localeHeaders[this._options.locale][e]||"",this._options.columnValueGetters[e]||(t=>"")))}const e=document.createElement("tr");t.forEach(t=>e.append(t.html)),this._tableColumns=t,this._htmlHead.innerHTML="",this._htmlHead.append(e)}updateRows(t){t.deleted.forEach(t=>{const e=this._tableRows.findIndex(e=>e.task.uuid===t.uuid);1!==e&&this._tableRows.splice(e,1)}),t.changed.forEach(t=>{const e=this._tableRows.findIndex(e=>e.task.uuid===t.uuid);-1!==e&&(this._tableRows[e]=new l(t,this._tableColumns))}),t.added.forEach(t=>this._tableRows.push(new l(t,this._tableColumns))),this._htmlBody.innerHTML="",this._htmlBody.append(...this.getRowsHtmlRecursively(this._tableRows,null))}getRowsHtmlRecursively(t,e){const s=t.filter(t=>t.task.parentUuid===e).sort((t,e)=>t.task.compareTo(e.task)),n=[];for(const e of s)e.task.shown&&(n.push(e.html),e.task.expanded&&n.push(...this.getRowsHtmlRecursively(t,e.task.uuid)));return n}}class c{constructor(e,s){if(this._tasks=[],this._htmlSeparatorDragActive=!1,this.onMouseDownOnSep=t=>{t.target===this._htmlSeparator&&(this._htmlSeparatorDragActive=!0)},this.onMouseMoveOnSep=t=>{if(!this._htmlSeparatorDragActive)return!1;const e=this._htmlWrapper.offsetLeft,s=this._htmlWrapper.getBoundingClientRect().width,n=t.clientX-e;this._htmlTableWrapper.style.width=n-5+"px",this._htmlChartWrapper.style.width=s-n+"px"},this.onMouseUpOnSep=t=>{this._htmlSeparatorDragActive=!1},this.onRowClick=e=>{const s=e.target.dataset[t.ROW_UUID_DATASET_KEY],n=this._tasks.find(t=>t.uuid===s);this.selectTask(n)},this.onRowExpanderClick=e=>{const s=e.target;this.toggleTaskExpanded(s.dataset[t.ROW_UUID_DATASET_KEY])},this._options=new d(s),this._htmlContainer=document.querySelector(e),!this._htmlContainer)throw new Error("Container is null");this.createLayout()}get tasks(){return n.convertTasksToModels(this._tasks)}set tasks(t){const e=this.updateTasks(t),s=n.detectTaskChanges(e);this.update(s)}get selectedTask(){return this._selectedTask?n.convertTasksToModels([this._selectedTask])[0]:null}set selectedTask(t){const e=this._tasks.find(e=>e.externalId===t.id);e!==this._selectedTask&&this.selectTask(e)}set locale(t){t!==this._options.locale&&(this._options.locale=t,this.updateLocale())}set chartScale(t){t!==this._options.chartScale&&(this._options.chartScale=t,this.updateChartScale())}set chartBarMode(t){t!==this._options.chartBarMode&&(this._options.chartBarMode=t,this.updateChartBarMode())}destroy(){this.removeSepEventListeners(),this.removeRowEventListeners(),this._htmlWrapper.remove()}removeSepEventListeners(){document.removeEventListener("mousedown",this.onMouseDownOnSep),document.removeEventListener("mousemove",this.onMouseMoveOnSep),document.removeEventListener("mouseup",this.onMouseUpOnSep)}removeRowEventListeners(){document.removeEventListener(t.ROW_CLICK,this.onRowClick),document.removeEventListener(t.CELL_EXPANDER_CLICK,this.onRowExpanderClick)}createLayout(){const e=document.createElement("div");e.classList.add(t.WRAPPER_CLASS);const s=document.createElement("div");s.classList.add(t.TABLE_WRAPPER_CLASS);const n=document.createElement("div");n.classList.add(t.CHART_WRAPPER_CLASS);const a=document.createElement("div");a.classList.add(t.SEPARATOR_CLASS),this._table=new u(this._options),this._chart=new o(this._options),e.append(s),e.append(a),e.append(n),s.append(this._table.html),n.append(this._chart.html),this._htmlContainer.append(e),this._htmlWrapper=e,this._htmlTableWrapper=s,this._htmlChartWrapper=n,this._htmlSeparator=a,document.addEventListener("mousedown",this.onMouseDownOnSep),document.addEventListener("mousemove",this.onMouseMoveOnSep),document.addEventListener("mouseup",this.onMouseUpOnSep),document.addEventListener(t.ROW_CLICK,this.onRowClick),document.addEventListener(t.CELL_EXPANDER_CLICK,this.onRowExpanderClick)}updateTasks(t){const e=this._tasks,s=n.getTasksIdsMap(e),a=n.convertModelsToTasks(t,s);return this._tasks=a,{oldTasks:e,newTasks:a}}toggleTaskExpanded(t){let e;const s=[];for(const n of this._tasks)e||n.uuid!==t?n.parentUuid===t&&s.push(n):e=n;if(!e)return;e.expanded=!e.expanded,s.forEach(t=>t.shown=!t.shown);const a=[e,...s],i=this._selectedTask;i&&i!==e&&n.checkPaternity(this._tasks,e,i)&&(i.selected=!1,this._selectedTask=null,i.parentUuid!==e.uuid&&a.push(i)),this.update({added:[],deleted:[],changed:a,all:this._tasks})}selectTask(t){const e=this._selectedTask;if(!e&&!t||e===t)return;this._selectedTask=null;const s=[];e&&(e.selected=!1,s.push(e)),t&&(t.selected=!0,s.push(t),this._selectedTask=t),this.update({added:[],deleted:[],changed:s,all:this._tasks})}update(t){this._table.update(!1,t),this._chart.update(!1,t)}updateLocale(){this._table.update(!0,null),this._chart.update(!0,null)}updateChartScale(){this._chart.update(!0,null)}updateChartBarMode(){this._chart.update(!0,null)}}export{c as TsGantt,o as TsGanttChart,d as TsGanttOptions,u as TsGanttTable,n as TsGanttTask,i as TsGanttTaskChangesDetectionResult,s as TsGanttTaskModel,a as TsGanttTaskUpdateResult};
